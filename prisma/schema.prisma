// --------------------------------------
// KONFIGURASI CLIENT & DATABASE
// --------------------------------------

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" // Ganti ke "mysql" jika Anda menggunakan MySQL
  url      = env("DATABASE_URL")
}

// --------------------------------------
// 1. USER & AUTH (Vendor / Admin / Usher)
// --------------------------------------

enum UserRole {
  ADMIN
  CLIENT
  USHER
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String   // Hashed password
  name      String?
  role      UserRole @default(CLIENT)
  
  invitations Invitation[] // Satu user (vendor) bisa mengelola banyak undangan

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// --------------------------------------
// 2. INVITATION (Inti Sistem)
// --------------------------------------

model Invitation {
  id            String   @id @default(uuid())
  slug          String   @unique // URL unik, cth: evory.id/romeo-juliet
  
  // --- KONFIGURASI TAMPILAN (Logic Template) ---
  templateId    String   @default("minimalist-01") // Gunakan slug template
  isActive      Boolean  @default(true)

  @@index([slug])
  
  // --- DATA MEMPELAI ---
  groomName     String
  groomNick     String
  groomFather   String?
  groomMother   String?
  
  brideName     String
  brideNick     String
  brideFather   String?
  brideMother   String?
  
  // --- DATA ACARA ---
  eventDate     DateTime
  eventTime     String   @default("08:00 WIB - Selesai")
  location      String
  mapUrl        String?
  
  // --- RELASI ---
  userId        String?
  user          User?    @relation(fields: [userId], references: [id])

  guests        Guest[]
  wishes        Wish[]

  // --- FIELD BARU UNTUK ASET DINAMIS ---
  // Aset ini diisi URL dari Supabase (bukan file fisik)
  coverImageUrl   String?  @default("https://.../default-cover.svg") 
  wingImageUrl    String?  @default("https://.../default-wing.svg")
  musicUrl        String?
  
  // Konfigurasi Spesifik Template (JSON)
  // Di sini kita simpan warna, font, atau pilihan aset wayang
  themeConfig     Json?    
  // Contoh isi Json: { "primaryColor": "#818362", "pattern": "batik-v1" }

  gallery         String[] // Array URL Foto Gallery
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
}

// --------------------------------------
// 3. GUEST & RSVP (Tamu & Tiket)
// --------------------------------------

enum RsvpStatus {
  PENDING
  ATTENDING
  DECLINED
}

model Guest {
  id           String     @id @default(uuid())
  invitationId String
  invitation   Invitation @relation(fields: [invitationId], references: [id], onDelete: Cascade)
  
  name         String
  category     String?    // Cth: VIP, Keluarga, Teman Kantor
  guestCode    String     @unique // Kode Unik untuk URL Login & QR Code (cth: AB12CD)
  
  // --- RSVP DATA ---
  rsvpStatus   RsvpStatus @default(PENDING)
  pax          Int        @default(1) // Jumlah orang yang AKTUAL hadir (diisi saat RSVP)
  totalPaxAllocated Int   @default(1) // Jatah kursi MAKSIMAL yang diberikan (diisi Admin)

  // --- CHECK-IN LOGIC (Scanner) ---
  isCheckedIn  Boolean    @default(false)
  checkInTime  DateTime?

  wishes       Wish[]

  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

// --------------------------------------
// 4. WISHES (Ucapan & Doa)
// --------------------------------------

model Wish {
  id           String     @id @default(uuid())
  message      String     @db.Text
  
  invitationId String
  invitation   Invitation @relation(fields: [invitationId], references: [id], onDelete: Cascade)
  
  guestId      String?
  guest        Guest?     @relation(fields: [guestId], references: [id])
  
  createdAt    DateTime   @default(now())
}